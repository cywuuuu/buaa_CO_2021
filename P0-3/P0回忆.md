# 2021年P0课上评测回忆

## 写在前面的话



### 新的回忆




昨天考完之后发现自己考试题竟然还记着，就写了一下复盘，今天贴到这里，希望可以和大家讨论一下。

# L1_投票器

- 刚开始是想着先用一个子电路判断是否弃权，再根据弃权情况决定是否将其纳入最后的通过判断环节，但是发现无法实现通过判断环节不能根据弃权情况灵活地进行输入数量的变化（等一个实现方法）。
- 之后就想到，由于最后是判断同意票与反对票的数量，所以可以把投票量化，一张同意票为1，一张反对票为-1，一张弃权票为0，同时考虑到组长的一票否决权，可以把一票否决视为-3；最后的通过判定为四张票加起来的数值能否大于0。
- 这样电路实现就很简单了。首先用MUX量化输入的2bit投票类型，由于总票数最高为4，最低为-6，为了之后使用加法器方便，因此把一张票量化用4位补码，即同意票为0001，反对票为1111，弃权票为0000，一票否决为1101（理论复习：x的相反数补码=x各位1变0、0变1再加1）；用4个MUX元件把投票量化后就可以无脑加了，最后通过用比较器和与0比较，或者是直接判断最高位（符号位）都可以得出最终判断结果。注意使用比较器要分清是二进制补码比较（默认）还是无符号数比较（许多循环跳出条件用这个）。

# L2_Mealy型有限状态机

- 一共有5个状态（0/1，2，20，201，202），其中201和202读取到1时在上升沿直接回到0/1状态。因为是5个状态，所以再不情愿也要用3位数来表示状态（点真值表点得手要麻了orz）。刚开始是想把201和202合并为一个状态的，后来发现题目要求2011和2021是不同的输出，于是含泪改位数……画出状态转移图之后就是老三样了，生成状态转移电路、接寄存器、做状态输出电路。
- 题目要求异步复位，直接把复位信号接到寄存器reset端即可。
- 另外注意，所有时序电路的题都要看一下测试电路中时钟信号是否为输入端，若是则记得把自己电路中的clock元件都换成输入信号。

# L3_类斐波那契数列

整体设计参照原斐波那契数的题，这里先贴一下我做的原题电路方便讲解： ![微信图片_20211020222935.png](http://10.212.27.185:9199/cscore-image/20375190/e4a27977-05c0-4de3-9642-4126e0cd888d/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20211020222935.png)![微信图片_20211020222938.png](http://10.212.27.185:9199/cscore-image/20375190/9ce31533-669d-4ee0-8ac8-9f12226ea31e/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20211020222938.png)![微信图片_20211020222930.png](http://10.212.27.185:9199/cscore-image/20375190/951cdb84-b4ff-4924-9548-258e4c2b2ae3/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20211020222930.png)

- 可以看到，和原题有变化的地方：①计算时需要的数据从前两个数变为前三个数。需要作出的改变第一是在赋初值上，需要我们假定s[-2]=s[-1]=1，这样才能据此计算出正确的s[1]和s[2]；第二是要存的数据为3个，分别为now，前一个数prev1和前第二个数prev2，对应的赋值为prev2=prev1,prev1=now,now=now+(prev1^prev2)。注意用MUX实现prev1在第一个周期的初值以及prev2在前两个周期的初值（这个要用2位计数器和四选一MUX来实现）。②input为5位。首先64个周期是能撑住5位二进制数的循环运算的，不必使用快速幂简化算数流程，其次还是记得input通过extend后再与计数器值作比较，比较器依旧选用Unsigned。
- 最后别忘了计算逻辑中寄存器接使能端，以及父电路中在freeze信号到来之前持续输出0。

## 望批评指正，有更好的思路欢迎讨论！